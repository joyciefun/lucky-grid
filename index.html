<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>九宮格抽獎</title>
<style>
body{font-family:sans-serif;margin:24px}
.grid{display:grid;grid-template-columns:repeat(3,110px);gap:10px}
.cell{
  height:110px;display:flex;align-items:center;justify-content:center;
  border:1px solid #ccc;border-radius:12px;text-align:center
}
.active{outline:3px solid #000}
button{height:110px;width:110px;border-radius:12px;background:#000;color:#fff}
</style>
</head>
<body>

<h3>九宮格抽獎</h3>
<div class="grid" id="grid"></div>

<script>

// 順時針 8 格位置
const ringPositions = [0,1,2,5,8,7,6,3];

// 每個 ringIndex 對應一個獎（這裡直接固定好）
const ringPrizes = [
  "特別獎",
  "現金200元",
  "現金600元",
  "刮刮樂200元一張",
  "特別獎",
  "刮刮樂300元一張",
  "大樂透隨機快選4張",
  "刮刮樂500元一張"
];

// 權重（跟 ringIndex 一一對應）
const weights = [3,35,8,25,5,16,8,3];

const grid = document.getElementById("grid");
const cells = [];

for(let i=0;i<9;i++){
  const div = document.createElement("div");
  if(i===4){
    div.innerHTML = `<button id="btn">開始</button>`;
  }else{
    div.className="cell";
    const ringIdx = ringPositions.indexOf(i);
    div.textContent = ringPrizes[ringIdx];
  }
  grid.appendChild(div);
  cells.push(div);
}

function weightedPick(){
  const sum = weights.reduce((a,b)=>a+b,0);
  let r = Math.random()*sum;
  for(let i=0;i<weights.length;i++){
    r -= weights[i];
    if(r<0) return i;   // 回傳 ringIndex
  }
  return weights.length-1;
}

function highlight(ringIdx){
  cells.forEach(c=>c.classList.remove("active"));
  const pos = ringPositions[ringIdx];
  cells[pos].classList.add("active");
}

let running=false;
const btn=document.getElementById("btn");

btn.onclick=()=>{
  if(running) return;
  running=true;
  btn.disabled=true;

  const targetRingIdx = weightedPick(); // 直接抽 ringIndex

  let step=0;
  let delay=80;
  const totalSteps = 8*4 + targetRingIdx;

  const tick=()=>{
    highlight(step%8);
    if(step<totalSteps){
      if(step>totalSteps-12) delay+=25;
      step++;
      setTimeout(tick,delay);
    }else{
      running=false;
      btn.disabled=false;
      alert("抽中："+ringPrizes[targetRingIdx]);
    }
  };

  tick();
};

</script>
</body>
</html>

